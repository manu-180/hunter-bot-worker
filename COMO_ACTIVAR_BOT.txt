=============================================================================
üîß PROBLEMA: El bot no est√° recopilando dominios
=============================================================================

RESUMEN DEL PROBLEMA:
El domain_hunter_worker.py NO va a funcionar hasta que habilites el bot 
para tu usuario en Supabase.

¬øPOR QU√â NO FUNCIONA?
El worker busca usuarios con bot_enabled = true en la tabla hunter_configs.
Si no hay ning√∫n usuario con el bot habilitado, el worker se queda 
esperando sin hacer nada.

=============================================================================
‚úÖ SOLUCI√ìN R√ÅPIDA (3 PASOS)
=============================================================================

PASO 1: Ejecutar el diagn√≥stico
--------------------------------
1. Abre Supabase ‚Üí SQL Editor
2. Carga y ejecuta el archivo: SOLUCION_RAPIDA_BOT.sql
3. En los resultados, busca tu user_id en la secci√≥n "USUARIOS REGISTRADOS"

PASO 2: Habilitar el bot
-------------------------
Copia tu user_id del paso anterior y ejecuta esto en Supabase:

-- Si ya tienes un registro en hunter_configs:
UPDATE hunter_configs 
SET 
    bot_enabled = true,
    nicho = 'inmobiliarias',
    ciudades = ARRAY['Buenos Aires', 'C√≥rdoba', 'Rosario', 'Mendoza'],
    pais = 'Argentina'
WHERE user_id = 'TU_USER_ID_AQUI';  -- ‚ö†Ô∏è REEMPLAZAR con tu user_id

-- Si NO tienes registro (usuario nuevo):
INSERT INTO hunter_configs (
    user_id, bot_enabled, nicho, ciudades, pais,
    from_name, email_subject, is_active
) VALUES (
    'TU_USER_ID_AQUI',  -- ‚ö†Ô∏è REEMPLAZAR
    true, 'inmobiliarias',
    ARRAY['Buenos Aires', 'C√≥rdoba', 'Rosario', 'Mendoza'],
    'Argentina', 'Mi Empresa', 'Potenciemos tu negocio juntos', true
);

PASO 3: Verificar que funcion√≥
-------------------------------
SELECT user_id, bot_enabled, nicho, ciudades, pais
FROM hunter_configs
WHERE bot_enabled = true;

Si ves tu usuario aqu√≠ con bot_enabled = true, ¬°ya est√°! üéâ

=============================================================================
üöÄ INICIAR EL BOT
=============================================================================

En Railway (producci√≥n):
El bot ya est√° corriendo con start_workers.py. Solo verifica los logs.

Local (desarrollo):
  python start_workers.py         # Ambos bots
  python domain_hunter_worker.py  # Solo domain hunter

=============================================================================
üìä VERIFICAR QUE EST√Å FUNCIONANDO
=============================================================================

-- Ver logs en tiempo real:
SELECT created_at, level, action, domain, message
FROM hunter_logs
WHERE user_id = 'TU_USER_ID_AQUI'
ORDER BY created_at DESC
LIMIT 50;

-- Ver cu√°ntos dominios se est√°n agregando:
SELECT status, COUNT(*) as cantidad
FROM leads
WHERE user_id = 'TU_USER_ID_AQUI'
GROUP BY status;

-- Ver los √∫ltimos dominios agregados:
SELECT domain, status, created_at
FROM leads
WHERE user_id = 'TU_USER_ID_AQUI'
ORDER BY created_at DESC
LIMIT 20;

=============================================================================
üéØ C√ìMO FUNCIONA EL SISTEMA
=============================================================================

1. DOMAIN HUNTER WORKER (domain_hunter_worker.py)
   - Busca dominios en Google usando SerpAPI
   - Solo funciona si hay usuarios con bot_enabled = true
   - Usa rotaci√≥n autom√°tica de 120+ nichos y 2000+ ciudades
   - Guarda dominios en tabla leads con status = 'pending'
   - Respeta horario laboral (8 AM - 7 PM) para ahorrar cr√©ditos

2. LEADSNIPER WORKER (main.py)
   - Toma dominios con status = 'pending'
   - Hace scraping para encontrar emails
   - Env√≠a emails usando Resend
   - Tambi√©n respeta horario laboral

3. FLUJO COMPLETO:
   pending ‚Üí scraping ‚Üí scraped ‚Üí queued_for_send ‚Üí sending ‚Üí sent
                     ‚Üò failed (si hay error)

=============================================================================
‚öôÔ∏è CAMBIAR LA CONFIGURACI√ìN
=============================================================================

Puedes cambiar qu√© busca el bot en cualquier momento:

UPDATE hunter_configs 
SET 
    nicho = 'agencias de marketing',
    ciudades = ARRAY['Madrid', 'Barcelona', 'Valencia'],
    pais = 'Espa√±a'
WHERE user_id = 'TU_USER_ID_AQUI';

Nichos disponibles: inmobiliarias, agencias de marketing, estudios contables,
despachos de abogados, cl√≠nicas dentales, gimnasios, restaurantes, hoteles,
y 110+ m√°s.

=============================================================================
üõ†Ô∏è SOLUCI√ìN DE PROBLEMAS
=============================================================================

PROBLEMA: El bot no encuentra dominios
SOLUCI√ìN: Resetear el tracking

  DELETE FROM domain_search_tracking 
  WHERE user_id = 'TU_USER_ID_AQUI';

PROBLEMA: Ver qu√© est√° buscando ahora

  SELECT nicho, ciudad, pais, current_page, last_searched_at
  FROM domain_search_tracking
  WHERE user_id = 'TU_USER_ID_AQUI'
  ORDER BY last_searched_at DESC
  LIMIT 10;

PROBLEMA: Quiero que busque m√°s r√°pido
SOLUCI√ìN: Editar domain_hunter_worker.py l√≠neas 38-39:

  MIN_DELAY_BETWEEN_SEARCHES = 3  # Reducir a 1 (gasta m√°s cr√©ditos)
  MAX_DELAY_BETWEEN_SEARCHES = 10  # Reducir a 5

=============================================================================
üîë VARIABLES DE ENTORNO NECESARIAS (.env)
=============================================================================

SUPABASE_URL=tu_supabase_url
SUPABASE_KEY=tu_supabase_service_role_key
SERPAPI_KEY=tu_serpapi_key                    # OBLIGATORIO
RESEND_API_KEY=tu_resend_api_key             # Opcional al principio

=============================================================================
‚ùì PREGUNTAS FRECUENTES
=============================================================================

P: ¬øCu√°nto tarda en empezar a agregar dominios?
R: Entre 1-5 minutos despu√©s de habilitar el bot.

P: ¬øCu√°ntos dominios agrega por hora?
R: T√≠picamente entre 50-200 dominios/hora dependiendo del nicho.

P: ¬øGasta muchos cr√©ditos de SerpAPI?
R: No, solo busca de 8 AM a 7 PM con delays de 3-10 segundos.

P: ¬øPuedo tener varios usuarios con el bot activo?
R: S√≠, cada usuario puede tener su propio bot independiente.

P: ¬øEl bot se detiene cuando no hay m√°s dominios?
R: No, rota entre 120+ nichos y 2000+ ciudades autom√°ticamente.

=============================================================================
üìù ARCHIVOS √öTILES
=============================================================================

SOLUCION_RAPIDA_BOT.sql   - Script para diagnosticar y solucionar
diagnostico_bot.sql       - Diagn√≥stico detallado completo
soluciones_bot.sql        - Soluciones para problemas comunes
domain_hunter_worker.py   - Bot que busca dominios
main.py                   - Bot que procesa dominios
start_workers.py          - Inicia ambos bots en paralelo

=============================================================================
üéâ CONCLUSI√ìN
=============================================================================

Una vez que ejecutes el SQL y habilites bot_enabled = true, el bot deber√≠a
empezar a funcionar autom√°ticamente.

Verifica en los logs y en la tabla leads que est√° agregando dominios.

¬°Cualquier duda, revisa SOLUCION_RAPIDA_BOT.sql! üöÄ

=============================================================================
