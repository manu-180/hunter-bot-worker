================================================================================
ğŸš¨ PROBLEMA ENCONTRADO Y SOLUCIÃ“N
================================================================================

PROBLEMA:
  El bot Domain Hunter Worker NO estÃ¡ recopilando dominios nuevos porque
  la tabla "domain_search_tracking" estÃ¡ VACÃA (0 filas).

  Sin tracking, el bot no sabe quÃ© combinaciones (nicho + ciudad + paÃ­s)
  buscar en Google.

SÃNTOMAS QUE CONFIRMAN EL PROBLEMA:
  âœ… Bot habilitado (bot_enabled = true)
  âœ… LeadSniper funcionando (procesando emails)
  âŒ domain_search_tracking: 0 filas
  âŒ No se agregan dominios NUEVOS desde ayer
  âŒ Los 281 leads existentes son todos de ayer

================================================================================
âœ… SOLUCIÃ“N EN 4 PASOS (15 minutos)
================================================================================

PASO 1: Ejecutar SQL para crear el tracking inicial
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Ir a Supabase SQL Editor
2. Abrir el archivo: SOLUCION_TRACKING_VACIO.sql
3. Copiar TODO el contenido desde "PASO 2: Crear combinaciones iniciales"
4. Pegar en SQL Editor
5. Ejecutar

Esto crearÃ¡ 30 combinaciones de bÃºsqueda:
  - 10 nichos diferentes
  - 3 ciudades (Buenos Aires, CÃ³rdoba, Rosario)
  - Argentina

â±ï¸  Tiempo: 2 minutos


PASO 2: Verificar que se crearon las combinaciones
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ejecutar esta query:

  SELECT COUNT(*) FROM domain_search_tracking 
  WHERE user_id = '38152119-7da4-442e-9826-20901c65f42e';

Resultado esperado: 30

Si ves 30, âœ… PERFECTO, continuar al paso 3.
Si ves 0, âŒ hubo un error, revisar logs de Supabase.

â±ï¸  Tiempo: 30 segundos


PASO 3: Verificar SERPAPI_KEY en .env
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Abrir el archivo .env y verificar que tenga:

  SERPAPI_KEY=tu_serpapi_key_aqui

Si NO estÃ¡ configurada:
  1. Ir a https://serpapi.com/
  2. Crear cuenta (plan gratuito: 100 bÃºsquedas/mes)
  3. Copiar tu API Key
  4. Agregar al .env: SERPAPI_KEY=tu_key

â±ï¸  Tiempo: 5 minutos (si necesitas crear cuenta)


PASO 4: Reiniciar el Domain Hunter Worker
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Si domain_hunter_worker.py estÃ¡ corriendo, detenerlo (Ctrl+C)
2. Ejecutar nuevamente:

   python domain_hunter_worker.py

3. Verificar en la terminal que muestre:

   ğŸ” DOMAIN HUNTER WORKER - Iniciando
   âœ… SerpAPI configurada
   ğŸ‘¥ 1 usuario(s) con bot activo
   ğŸ¯ RotaciÃ³n: inmobiliarias | Buenos Aires, Argentina | PÃ¡gina 1
   ğŸ” Query SerpAPI: "inmobiliarias en Buenos Aires Argentina"
   ğŸ“Š SerpAPI devolviÃ³ 20 resultados
   âœ… Encontrados 15 dominios vÃ¡lidos

4. Si ves esto, âœ… EL BOT ESTÃ FUNCIONANDO!

â±ï¸  Tiempo: 2 minutos

================================================================================
ğŸ“Š VERIFICAR QUE FUNCIONE
================================================================================

OPCIÃ“N A - Ver en Supabase (30 segundos):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ejecutar:

  SELECT domain, created_at 
  FROM leads 
  WHERE user_id = '38152119-7da4-442e-9826-20901c65f42e'
  ORDER BY created_at DESC 
  LIMIT 10;

Si ves dominios con fecha/hora de HOY (no de ayer), âœ… FUNCIONA!


OPCIÃ“N B - Ver en la terminal del worker:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DeberÃ­as ver cada 10-60 segundos mensajes como:

  ğŸ¯ RotaciÃ³n: agencias de marketing | CÃ³rdoba, Argentina | PÃ¡gina 1
  ğŸ” Query SerpAPI: "agencias de marketing en CÃ³rdoba Argentina"
  âœ… Encontrados 12 dominios vÃ¡lidos
  ğŸ’¾ 12 dominios ofrecidos a la cola (solo nuevos se insertan)


OPCIÃ“N C - Ver el tracking:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ejecutar:

  SELECT nicho, ciudad, current_page, total_domains_found, last_searched_at
  FROM domain_search_tracking
  WHERE user_id = '38152119-7da4-442e-9826-20901c65f42e'
  ORDER BY last_searched_at DESC NULLS LAST
  LIMIT 5;

DeberÃ­as ver:
  - last_searched_at con fechas RECIENTES (no NULL)
  - total_domains_found aumentando
  - current_page incrementÃ¡ndose

================================================================================
ğŸ†˜ SI SIGUE SIN FUNCIONAR
================================================================================

1. Verificar terminal del worker:
   Â¿Muestra errores? Â¿Dice "SerpAPI key not configured"?

2. Verificar crÃ©ditos de SerpAPI:
   https://serpapi.com/dashboard
   Â¿Tienes crÃ©ditos disponibles?

3. Revisar logs en Supabase:
   SELECT * FROM hunter_logs 
   WHERE user_id = '38152119-7da4-442e-9826-20901c65f42e' 
   ORDER BY created_at DESC LIMIT 20;

4. Verificar que AMBOS workers estÃ©n corriendo:
   Terminal 1: python domain_hunter_worker.py
   Terminal 2: python main.py

5. Revisar archivo .env:
   - SERPAPI_KEY configurada
   - SUPABASE_URL correcta
   - SUPABASE_KEY correcta

================================================================================
ğŸ“ EXPLICACIÃ“N TÃ‰CNICA (para entender quÃ© pasÃ³)
================================================================================

Tu sistema tiene 2 workers:

1. domain_hunter_worker.py (Recolector)
   - Busca dominios en Google usando SerpAPI
   - Guarda en tabla "leads" con status "pending"
   - Usa tabla "domain_search_tracking" para saber QUÃ‰ buscar

2. main.py (Procesador)
   - Toma dominios "pending" de la tabla "leads"
   - Los scrapea para buscar emails
   - EnvÃ­a emails a los que tienen email

El problema:
  - Worker 2 (main.py) estaba funcionando âœ…
  - Worker 1 (domain_hunter_worker.py) NO estaba agregando dominios âŒ
  - RazÃ³n: domain_search_tracking vacÃ­o (0 combinaciones)
  - Sin combinaciones, el worker no sabÃ­a quÃ© buscar

La soluciÃ³n:
  - Crear 30 combinaciones en domain_search_tracking
  - El worker las va a usar para buscar en Google
  - Va a empezar a agregar dominios nuevos automÃ¡ticamente

CÃ³mo funciona el sistema de rotaciÃ³n:
  1. Worker lee domain_search_tracking
  2. Toma la combinaciÃ³n con menor "current_page" y "is_exhausted = false"
  3. Busca en SerpAPI: "{nicho} en {ciudad} {paÃ­s}"
  4. Guarda dominios encontrados en "leads"
  5. Incrementa "current_page" para la prÃ³xima bÃºsqueda
  6. Cuando no encuentra mÃ¡s, marca "is_exhausted = true"
  7. Pasa a la siguiente combinaciÃ³n
  8. Cuando todas estÃ¡n exhausted, resetea y empieza de nuevo

================================================================================
ğŸ“ ARCHIVOS CREADOS PARA TI
================================================================================

1. ESTADO_ACTUAL_BASE_DATOS.txt
   - Contexto completo de tu base de datos
   - Estado actual de todas las tablas
   - DiagnÃ³stico del problema

2. SOLUCION_TRACKING_VACIO.sql
   - Comandos SQL listos para copiar/pegar
   - Crea las 30 combinaciones de bÃºsqueda
   - Queries de monitoreo y verificaciÃ³n

3. SOLUCION_RAPIDA.txt (este archivo)
   - Pasos exactos para solucionar
   - Verificaciones y troubleshooting
   - ExplicaciÃ³n tÃ©cnica

================================================================================
âœ… CHECKLIST FINAL
================================================================================

Antes de cerrar, verifica:

[ ] Ejecutaste el SQL de SOLUCION_TRACKING_VACIO.sql (PASO 2)
[ ] Verificaste que se crearon 30 combinaciones
[ ] Verificaste que SERPAPI_KEY estÃ¡ en .env
[ ] Reiniciaste domain_hunter_worker.py
[ ] Viste en la terminal mensajes de bÃºsqueda
[ ] Verificaste que se estÃ¡n agregando dominios NUEVOS
[ ] Ambos workers estÃ¡n corriendo (domain_hunter_worker.py y main.py)

Si todos estÃ¡n marcados, âœ… EL SISTEMA ESTÃ FUNCIONANDO CORRECTAMENTE!

================================================================================
ğŸ’¡ TIPS PARA EL FUTURO
================================================================================

- El bot tiene rotaciÃ³n automÃ¡tica de 50+ nichos, 17 paÃ­ses, 100+ ciudades
- No necesitas configurar manualmente quÃ© buscar
- Si quieres cambiar el foco, edita hunter_configs (nicho, ciudades, pais)
- El sistema resetea automÃ¡ticamente cuando todas las combinaciones se agotan
- Con SerpAPI plan gratuito (100 bÃºsquedas/mes): ~60-120 dominios/mes
- Considera upgrade a plan pagado si necesitas mÃ¡s dominios

================================================================================
FIN - Â¡Buena suerte con tu bot! ğŸš€
================================================================================
